{% comment %}Personalize Stepper block - Updated UI{% endcomment %}
{{ 'personalize-stepper.css' | asset_url | stylesheet_tag }}
<script src="{{ 'personalize-stepper.js' | asset_url }}" defer></script>

{% assign pd_config = product.metafields.personalize_design.config %}

{% if pd_config %}
  {% if pd_config.value %}
    {% assign pd_config_value = pd_config.value %}
    {% assign pd_config_obj = pd_config_value %}
  {% elsif pd_config.template_id %}
    {% assign pd_config_value = pd_config %}
    {% assign pd_config_obj = pd_config %}
  {% endif %}

  {% assign pd_config_obj = pd_config_obj %}

  <div
    id="pd-stepper-root"
    data-pd-stepper
    data-shop-domain="{{ shop.permanent_domain }}"
    data-product-id="{{ product.id }}"
    data-product-title="{{ product.title | escape }}"
    data-variant-title="{{ product.selected_or_first_available_variant.title | escape }}"
    {% if product.featured_image %}
      data-product-image="{{ product.featured_image | image_url: width: 1400 }}"
    {% endif %}
    {% if pd_config_obj %}
      data-template-id="{{ pd_config_obj.template_id }}"
      data-personalization-enabled="{{ pd_config_obj.personalization_enabled }}"
      data-text-enabled="{{ pd_config_obj.text_enabled | default: pd_config_obj.textEnabled }}"
    {% endif %}
  ></div>
{% endif %}

{% schema %}
{
  "name": "Personalize Stepper",
  "target": "section",
  "templates": ["product"],
  "settings": []
}
{% endschema %}
